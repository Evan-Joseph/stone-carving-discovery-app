# 第一阶段开发路线（已落地）

## 已完成

1. 初始化 `React + TypeScript + Vite` 工程与基础路由。
2. 新增数据构建脚本 `scripts/build_artifacts.py`，自动聚合：
   - 展品 PNG 抠图
   - 展品信息 JPG 与提取文本
   - 鲁迅章节逐页文本
   - 双向索引表格
3. 输出统一数据文件 `src/data/artifacts.json`（当前 61 条展品）。
4. 完成首版页面流：
   - 首页（数据总览 + 精选展品）
   - 发掘页（Three.js 3D画布 + 盲盒随机 + 单件停留 + 点击仪式化掉土）
   - 文物库（筛选 + 网格）
   - 详情页（官方介绍/书籍摘录/PDF索引 + Markdown解析 + 跳页）
   - PDF阅读页（页码跳转 + 本页关联展品反向跳转）
   - AI导游（全馆/展品双模式问询，前端不暴露AI配置）
   - 展厅模式（横屏单页整合：展品陈列 + 资料阅读 + AI问询）
5. 新增许愿发掘：可用 AI（或本地关键词降级）从待发掘列表中挑选下一件盲盒。
6. 发掘流程优化：采用“选目标/随机→轻触发掘→亮相收纳”阶段化流程，面向手机竖屏快速仪式感体验。
7. 遮罩优化：基于展品 alpha 轮廓生成完整土层覆盖，并以随机土块点击击碎掉落（4-6次完成）。
8. 资源缓存：新增 Service Worker，对静态资源与素材目录启用缓存，减少刷新重复加载。
9. 图片性能优化：构建脚本生成 WebP 缩略图/中图，前端以 `picture + srcset` 按场景加载。
10. 展厅性能优化：展品陈列列表接入虚拟滚动，降低横屏长列表渲染开销。
11. 首页视觉优化：新增“今日推荐”模块，重排移动端首屏信息节奏。
12. 新增后端 AI 服务：提供 `/api/ai/chat`、`/api/ai/chat-stream` 与 `/api/ai/wish`，支持 BigModel（GLM-4.7-Flash）与联网搜索工具配置。

## 设计参考

- 已解压 Stitch 案例：`开发资料/stitch_ref/stitch_cultural_discovery_home`
- 当前样式已吸收其“土色+馆藏感+移动端底部导航”思路，并改为项目可维护的主题变量体系。

## 下一步（第二阶段）

1. 发掘页升级为真实 3D：基于 PNG alpha 轮廓做几何加厚与边缘扰动。
2. 响应式专项优化：竖屏安全区、按钮可达性、横屏与馆内大屏（16:9）布局细化。
3. AI 导游接入多轮上下文管理与展品图像输入。
4. 资源优化：生成 webp 缩略图与分辨率分层加载。

## 响应式专项排期（2026-02-04 起）

1. **第 1 批（已完成）**
   - 安全区适配：`viewport-fit=cover`、顶部/底部 `safe-area` 内边距。
   - 底部导航触达优化：导航高度统一、点击区域扩大、移动端字体微调。
   - 横屏手机兜底：低高度场景下画布与聊天区高度约束。
2. **第 2 批（待完成）**
   - 竖屏发掘流程压缩：减少首屏信息层级，提升“一屏完成”能力。（进行中）
   - 详情页图文层次重排：移动端优先卡片节奏与 PDF 入口可见性。（已完成首版）
   - AI 页面重构：支持展品即时问询、全馆问询切换。（已完成）
   - 横屏单页展厅压缩：低高度（如 844×390）下三栏同屏展示陈列/阅读/AI。（已完成）
3. **第 3 批（待完成）**
   - 馆内大屏（16:9）模式：首页/发掘页双列信息密度与字号体系优化。（已完成首版网格）
   - 展厅单页模式：横屏入口与一屏信息整合。（已完成首版）
   - 可选“演示循环模式”：用于展厅连续播放场景。
